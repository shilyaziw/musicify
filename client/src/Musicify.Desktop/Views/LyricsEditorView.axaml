<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Musicify.Core.ViewModels"
             xmlns:converters="using:Musicify.Desktop.Converters"
             x:Class="Musicify.Desktop.Views.LyricsEditorView"
             x:DataType="vm:LyricsEditorViewModel">

    <UserControl.KeyBindings>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveLyricsCommand}" />
        <KeyBinding Gesture="Ctrl+F" Command="{Binding FormatLyricsCommand}" />
        <KeyBinding Gesture="Ctrl+P" Command="{Binding TogglePreviewCommand}" />
        <KeyBinding Gesture="Ctrl+Z" Command="{Binding UndoCommand}" />
        <KeyBinding Gesture="Ctrl+Y" Command="{Binding RedoCommand}" />
    </UserControl.KeyBindings>

    <Grid RowDefinitions="Auto,*,Auto,Auto">
        <!-- å·¥å…·æ  -->
        <Border Grid.Row="0"
                Background="#FAFAFA"
                BorderBrush="#E5E7EB"
                BorderThickness="0,0,0,1"
                Padding="10,5">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="ðŸ“ æ­Œè¯ç¼–è¾‘å™¨"
                          FontSize="18"
                          FontWeight="Bold"
                          Foreground="#1F2937"
                          VerticalAlignment="Center" />
                <Separator />
                <Button Content="ðŸ’¾ ä¿å­˜"
                       Command="{Binding SaveLyricsCommand}"
                       IsEnabled="{Binding IsModified}"
                       ToolTip.Tip="Ctrl+S" />
                <Button Content="â†¶ æ’¤é”€"
                       Command="{Binding UndoCommand}"
                       ToolTip.Tip="Ctrl+Z" />
                <Button Content="â†· é‡åš"
                       Command="{Binding RedoCommand}"
                       ToolTip.Tip="Ctrl+Y" />
                <Separator />
                <Button Content="ðŸ“ æ ¼å¼åŒ–"
                       Command="{Binding FormatLyricsCommand}"
                       ToolTip.Tip="Ctrl+F" />
                <Button Content="ðŸ‘ï¸ é¢„è§ˆ"
                       Command="{Binding TogglePreviewCommand}"
                       ToolTip.Tip="Ctrl+P" />
                <Separator />
                <Button Content="ðŸŽµ æŠ¼éŸµæ£€æŸ¥"
                       Command="{Binding CheckRhymeCommand}"
                       IsEnabled="{Binding !IsAnalyzingRhyme}"
                       ToolTip.Tip="æ£€æŸ¥æ­Œè¯æŠ¼éŸµæ¨¡å¼" />
            </StackPanel>
        </Border>

        <!-- ç¼–è¾‘å™¨åŒºåŸŸ -->
        <Grid Grid.Row="1" ColumnDefinitions="*,Auto,*">
            <!-- ç¼–è¾‘å™¨ (å•å±æ¨¡å¼) -->
            <TextBox Grid.Column="0"
                     Grid.ColumnSpan="3"
                     Name="LyricsTextEditor"
                     IsVisible="{Binding ShowPreview, Converter={x:Static BoolConverters.Not}}"
                     FontFamily="Consolas, Courier New, monospace"
                     FontSize="14"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     AcceptsTab="True"
                     Background="#FFFFFF"
                     Foreground="#1F2937"
                     CaretBrush="#1F2937"
                     SelectionBrush="#3B82F6"
                     Text="{Binding LyricsText}" />

            <!-- åˆ†å±æ¨¡å¼: ç¼–è¾‘å™¨ + é¢„è§ˆ -->
            <Grid Grid.Column="0"
                  Grid.ColumnSpan="3"
                  IsVisible="{Binding ShowPreview}"
                  ColumnDefinitions="*,Auto,*">
                <!-- ç¼–è¾‘å™¨ (å·¦ä¾§) -->
                <TextBox Grid.Column="0"
                         Name="LyricsTextEditorSplit"
                         FontFamily="Consolas, Courier New, monospace"
                         FontSize="14"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         AcceptsTab="True"
                         Background="#FFFFFF"
                         Foreground="#1F2937"
                         CaretBrush="#1F2937"
                         SelectionBrush="#3B82F6"
                         Text="{Binding LyricsText}" />

                <!-- åˆ†éš”çº¿ -->
                <Border Grid.Column="1"
                        Width="1"
                        Background="#E5E7EB" />

                <!-- é¢„è§ˆåŒºåŸŸ (å³ä¾§) -->
                <ScrollViewer Grid.Column="2" Background="#F9FAFB">
                    <TextBlock Text="{Binding LyricsText}"
                              TextWrapping="Wrap"
                              FontSize="16"
                              LineHeight="28"
                              Padding="20"
                              Foreground="#1F2937" />
                </ScrollViewer>
            </Grid>
        </Grid>

        <!-- çŠ¶æ€æ  -->
        <Border Grid.Row="2"
                Background="#F5F7FA"
                BorderBrush="#E5E7EB"
                BorderThickness="0,1,0,0"
                Padding="15,8">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="20">
                    <TextBlock>
                        <Run Text="å­—æ•°: " Foreground="#6B7280" />
                        <Run Text="{Binding WordCount}"
                             Foreground="#1F2937" FontWeight="SemiBold" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="æ®µè½: " Foreground="#6B7280" />
                        <Run Text="{Binding SectionCount}"
                             Foreground="#1F2937" FontWeight="SemiBold" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="è¡Œæ•°: " Foreground="#6B7280" />
                        <Run Text="{Binding LineCount}"
                             Foreground="#1F2937" FontWeight="SemiBold" />
                    </TextBlock>
                    <!-- æŠ¼éŸµä¿¡æ¯ -->
                    <TextBlock IsVisible="{Binding RhymeAnalysis, Converter={x:Static converters:IsNotNullConverter.Instance}}">
                        <Run Text="æŠ¼éŸµ: " Foreground="#6B7280" />
                        <Run Text="{Binding RhymeAnalysis.Pattern}"
                             Foreground="#1F2937" FontWeight="SemiBold" />
                        <Run Text=" (" Foreground="#6B7280" />
                        <Run Text="{Binding RhymeAnalysis.QualityScore}"
                             Foreground="#1F2937" FontWeight="SemiBold" />
                        <Run Text="åˆ†)" Foreground="#6B7280" />
                    </TextBlock>
                    <!-- æŠ¼éŸµæ£€æŸ¥ä¸­ -->
                    <TextBlock Text="æ­£åœ¨æ£€æŸ¥æŠ¼éŸµ..."
                              Foreground="#3B82F6"
                              IsVisible="{Binding IsAnalyzingRhyme}" />
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="15">
                    <!-- æœªä¿å­˜ -->
                    <TextBlock Text="æœªä¿å­˜"
                              Foreground="#DC2626"
                              IsVisible="{Binding IsModified}" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- æŠ¼éŸµå»ºè®®é¢æ¿ (å¯å±•å¼€) -->
        <Border Grid.Row="3"
                Background="#FFF7ED"
                BorderBrush="#FED7AA"
                BorderThickness="0,1,0,0"
                Padding="15,10"
                IsVisible="{Binding RhymeAnalysis, Converter={x:Static converters:IsNotNullConverter.Instance}}">
            <StackPanel Spacing="8" IsVisible="{Binding RhymeAnalysis.HasIssues}">
                <TextBlock Text="ðŸ’¡ æŠ¼éŸµå»ºè®®"
                          FontWeight="Bold"
                          Foreground="#9A3412"
                          FontSize="14" />
                <ItemsControl ItemsSource="{Binding RhymeAnalysis.Suggestions}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"
                                      Foreground="#7C2D12"
                                      TextWrapping="Wrap"
                                      Margin="0,2" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
