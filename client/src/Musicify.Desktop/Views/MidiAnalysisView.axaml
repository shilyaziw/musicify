<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Musicify.Core.ViewModels"
             xmlns:converters="using:Musicify.Desktop.Views"
             x:Class="Musicify.Desktop.Views.MidiAnalysisView"
             x:DataType="vm:MidiAnalysisViewModel">
    
    <ScrollViewer>
        <StackPanel Margin="40" Spacing="24">
            <!-- æ ‡é¢˜ -->
            <StackPanel Spacing="8">
                <TextBlock Text="ðŸŽµ MIDI åˆ†æž" 
                          FontSize="32" 
                          FontWeight="Bold"
                          Foreground="#1F2937" />
                <TextBlock Text="åˆ†æž MIDI æ–‡ä»¶ï¼Œæå–æ—‹å¾‹ç‰¹å¾å’ŒèŠ‚å¥æ¨¡å¼" 
                          FontSize="16"
                          Foreground="#6B7280" />
            </StackPanel>

            <!-- MIDI æ–‡ä»¶é€‰æ‹© -->
            <Border Background="#F9FAFB"
                    CornerRadius="12"
                    Padding="24"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1">
                <StackPanel Spacing="16">
                    <TextBlock Text="MIDI æ–‡ä»¶" 
                              FontSize="20" 
                              FontWeight="Bold"
                              Foreground="#1F2937" />
                    
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBox Grid.Column="0" 
                                Text="{Binding SelectedMidiFilePath, Mode=TwoWay}"
                                Watermark="MIDI æ–‡ä»¶è·¯å¾„..."
                                IsReadOnly="True"
                                Margin="0,0,10,0" />
                        <Button Grid.Column="1" 
                               Content="ðŸ“ é€‰æ‹©æ–‡ä»¶"
                               Command="{Binding SelectMidiFileCommand}"
                               Padding="20,10" />
                    </Grid>
                    
                    <Button Content="ðŸ”„ åˆ†æž MIDI æ–‡ä»¶"
                           Command="{Binding AnalyzeMidiFileCommand}"
                           IsEnabled="{Binding AnalyzeMidiFileCommand, Converter={x:Static converters:CommandCanExecuteConverter.Instance}}"
                           HorizontalAlignment="Stretch"
                           Padding="20,12"
                           IsVisible="{Binding IsAnalyzing, Converter={x:Static converters:BoolToInverseConverter.Instance}}" />
                    
                    <StackPanel IsVisible="{Binding IsAnalyzing}"
                               HorizontalAlignment="Center"
                               Spacing="10">
                        <TextBlock Text="æ­£åœ¨åˆ†æž..." 
                                  FontSize="14"
                                  Foreground="#6B7280" />
                        <ProgressBar IsIndeterminate="True"
                                    Width="200"
                                    Height="4" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- MIDI æ–‡ä»¶ä¿¡æ¯ -->
            <Border Background="#F9FAFB"
                    CornerRadius="12"
                    Padding="24"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1"
                    IsVisible="{Binding MidiFileInfo, Converter={x:Static converters:IsNotNullConverter.Instance}}">
                <StackPanel Spacing="16">
                    <TextBlock Text="æ–‡ä»¶ä¿¡æ¯" 
                              FontSize="20" 
                              FontWeight="Bold"
                              Foreground="#1F2937" />
                    
                    <Grid ColumnDefinitions="150,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto">
                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                   Text="æ–‡ä»¶è·¯å¾„:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="0" Grid.Column="1" 
                                   Text="{Binding MidiFileInfo.FilePath}"
                                   Foreground="#1F2937"
                                   TextWrapping="Wrap" />
                        
                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                   Text="éŸ³è½¨æ•°é‡:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="1" Grid.Column="1" 
                                   Text="{Binding MidiFileInfo.TrackCount}"
                                   Foreground="#1F2937" />
                        
                        <TextBlock Grid.Row="2" Grid.Column="0" 
                                   Text="æ—¶é•¿:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="2" Grid.Column="1" 
                                   Text="{Binding MidiFileInfo.Duration, StringFormat='{}{0:mm\\:ss}'}"
                                   Foreground="#1F2937" />
                        
                        <TextBlock Grid.Row="3" Grid.Column="0" 
                                   Text="Ticks/Quarter:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="3" Grid.Column="1" 
                                   Text="{Binding MidiFileInfo.TicksPerQuarterNote}"
                                   Foreground="#1F2937" />
                        
                        <TextBlock Grid.Row="4" Grid.Column="0" 
                                   Text="é€Ÿåº¦ (BPM):" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="4" Grid.Column="1" 
                                   Text="{Binding MidiFileInfo.Tempo}"
                                   Foreground="#1F2937" />
                    </Grid>
                </StackPanel>
            </Border>

            <!-- åˆ†æžç»“æžœ -->
            <Border Background="#F9FAFB"
                    CornerRadius="12"
                    Padding="24"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1"
                    IsVisible="{Binding AnalysisResult, Converter={x:Static converters:IsNotNullConverter.Instance}}">
                <StackPanel Spacing="16">
                    <TextBlock Text="åˆ†æžç»“æžœ" 
                              FontSize="20" 
                              FontWeight="Bold"
                              Foreground="#1F2937" />
                    
                    <Grid ColumnDefinitions="150,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto">
                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                   Text="æ€»éŸ³ç¬¦æ•°:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="0" Grid.Column="1" 
                                   Text="{Binding AnalysisResult.TotalNotes}"
                                   Foreground="#1F2937" />
                        
                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                   Text="éŸ³åŸŸèŒƒå›´:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="1" Grid.Column="1" 
                                   Text="{Binding AnalysisResult.NoteRange, Converter={x:Static converters:NoteRangeToStringConverter.Instance}}"
                                   Foreground="#1F2937" />
                        
                        <TextBlock Grid.Row="2" Grid.Column="0" 
                                   Text="èŠ‚å¥æ¨¡å¼:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="2" Grid.Column="0" 
                                   Text="èŠ‚å¥æ¨¡å¼:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="2" Grid.Column="1" 
                                   Text="{Binding AnalysisResult.RhythmPatterns, Converter={x:Static converters:DictionaryToStringConverter.Instance}}"
                                   Foreground="#1F2937"
                                   TextWrapping="Wrap" />
                        
                        <TextBlock Grid.Row="3" Grid.Column="0" 
                                   Text="è°ƒå¼ä¿¡æ¯:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="3" Grid.Column="1" 
                                   Text="{Binding AnalysisResult.ModeInfo.DetectedMode}"
                                   Foreground="#1F2937"
                                   TextWrapping="Wrap" />
                        
                        <TextBlock Grid.Row="4" Grid.Column="0" 
                                   Text="éŸ³ç¨‹åˆ†å¸ƒ:" 
                                   FontWeight="Bold"
                                   Foreground="#4B5563" />
                        <TextBlock Grid.Row="4" Grid.Column="1" 
                                   Text="{Binding AnalysisResult.IntervalDistribution, Converter={x:Static converters:DictionaryToStringConverter.Instance}}"
                                   Foreground="#1F2937"
                                   TextWrapping="Wrap" />
                    </Grid>
                </StackPanel>
            </Border>

            <!-- é”™è¯¯æ¶ˆæ¯ -->
            <Border Background="#FEE2E2"
                    CornerRadius="8"
                    Padding="16"
                    IsVisible="{Binding ErrorMessage, Converter={x:Static converters:IsNotNullConverter.Instance}}">
                <TextBlock Text="{Binding ErrorMessage}"
                          Foreground="#DC2626"
                          TextWrapping="Wrap" />
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
