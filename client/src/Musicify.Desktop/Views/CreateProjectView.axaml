<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Musicify.Core.ViewModels"
             xmlns:converters="using:Musicify.Desktop.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="Musicify.Desktop.Views.CreateProjectView"
             x:DataType="vm:CreateProjectViewModel">

    <Design.DataContext>
        <vm:CreateProjectViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto" Background="#F5F7FA">
        <!-- è¿›åº¦æ¡ -->
        <Border Grid.Row="0" Background="White" BoxShadow="0 2 4 0 #10000000" Padding="40,25">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Step 1 -->
                <StackPanel Grid.Column="0" Spacing="10">
                    <Border Height="4" Background="{Binding CurrentStep, Converter={StaticResource StepToBrushConverter}, ConverterParameter=1}"
                            CornerRadius="2" />
                    <TextBlock Text="1. åŸºæœ¬ä¿¡æ¯" FontSize="14" FontWeight="SemiBold"
                               Foreground="{Binding CurrentStep, Converter={StaticResource StepToForegroundConverter}, ConverterParameter=1}"
                               HorizontalAlignment="Center" />
                </StackPanel>

                <!-- Step 2 -->
                <StackPanel Grid.Column="1" Spacing="10">
                    <Border Height="4" Background="{Binding CurrentStep, Converter={StaticResource StepToBrushConverter}, ConverterParameter=2}"
                            CornerRadius="2" />
                    <TextBlock Text="2. æ­Œæ›²ä¿¡æ¯" FontSize="14" FontWeight="SemiBold"
                               Foreground="{Binding CurrentStep, Converter={StaticResource StepToForegroundConverter}, ConverterParameter=2}"
                               HorizontalAlignment="Center" />
                </StackPanel>

                <!-- Step 3 -->
                <StackPanel Grid.Column="2" Spacing="10">
                    <Border Height="4" Background="{Binding CurrentStep, Converter={StaticResource StepToBrushConverter}, ConverterParameter=3}"
                            CornerRadius="2" />
                    <TextBlock Text="3. åˆ›ä½œæ¨¡å¼" FontSize="14" FontWeight="SemiBold"
                               Foreground="{Binding CurrentStep, Converter={StaticResource StepToForegroundConverter}, ConverterParameter=3}"
                               HorizontalAlignment="Center" />
                </StackPanel>

                <!-- Step 4 -->
                <StackPanel Grid.Column="3" Spacing="10">
                    <Border Height="4" Background="{Binding CurrentStep, Converter={StaticResource StepToBrushConverter}, ConverterParameter=4}"
                            CornerRadius="2" />
                    <TextBlock Text="4. ç¡®è®¤åˆ›å»º" FontSize="14" FontWeight="SemiBold"
                               Foreground="{Binding CurrentStep, Converter={StaticResource StepToForegroundConverter}, ConverterParameter=4}"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- æ­¥éª¤å†…å®¹ -->
        <ScrollViewer Grid.Row="1">
            <Grid>
                <!-- Step 1: åŸºæœ¬ä¿¡æ¯ -->
                <StackPanel MaxWidth="600" Margin="40" Spacing="30"
                           IsVisible="{Binding CurrentStep, Converter={StaticResource EqualToConverter}, ConverterParameter=1}">
                    <TextBlock Text="ðŸ“ é¡¹ç›®åŸºæœ¬ä¿¡æ¯" FontSize="32" FontWeight="Bold" Foreground="#1F2937" />
                    
                    <!-- é¡¹ç›®åç§° -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="é¡¹ç›®åç§° *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <TextBox Text="{Binding ProjectName}"
                                 Watermark="ä¾‹å¦‚: å¤æ—¥å›žå¿†"
                                 FontSize="16" Padding="15" Height="50" />
                        <TextBlock Text="{Binding [ProjectName]}"
                                   IsVisible="{Binding [ProjectName], Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                   Foreground="#DC2626" FontSize="14" />
                    </StackPanel>

                    <!-- é¡¹ç›®è·¯å¾„ -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="é¡¹ç›®è·¯å¾„ *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox Grid.Column="0" Text="{Binding ProjectPath}"
                                     Watermark="é€‰æ‹©é¡¹ç›®ä¿å­˜ä½ç½®"
                                     FontSize="16" Padding="15" Height="50" IsReadOnly="True" />
                            <Button Grid.Column="1" Content="æµè§ˆ..." Command="{Binding BrowseProjectPathCommand}"
                                    Classes="secondary" Margin="10,0,0,0" Width="100" Height="50" />
                        </Grid>
                        <TextBlock Text="{Binding [ProjectPath]}"
                                   IsVisible="{Binding [ProjectPath], Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                   Foreground="#DC2626" FontSize="14" />
                    </StackPanel>
                </StackPanel>

                <!-- Step 2: æ­Œæ›²ä¿¡æ¯ -->
                <StackPanel MaxWidth="600" Margin="40" Spacing="30"
                           IsVisible="{Binding CurrentStep, Converter={StaticResource EqualToConverter}, ConverterParameter=2}">
                    <TextBlock Text="ðŸŽµ æ­Œæ›²ä¿¡æ¯" FontSize="32" FontWeight="Bold" Foreground="#1F2937" />
                    
                    <!-- æ­Œæ›²ç±»åž‹ -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="æ­Œæ›²ç±»åž‹ *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <ComboBox ItemsSource="{Binding SongTypes}" 
                                  SelectedItem="{Binding SongType}"
                                  FontSize="16" Padding="15" Height="50" />
                    </StackPanel>

                    <!-- æ—¶é•¿ -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="ç›®æ ‡æ—¶é•¿ *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <TextBox Text="{Binding Duration}"
                                 Watermark="ä¾‹å¦‚: 3åˆ†30ç§’"
                                 FontSize="16" Padding="15" Height="50" />
                    </StackPanel>

                    <!-- é£Žæ ¼ -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="é£Žæ ¼åŸºè°ƒ *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <ComboBox ItemsSource="{Binding Styles}" 
                                  SelectedItem="{Binding Style}"
                                  FontSize="16" Padding="15" Height="50" />
                    </StackPanel>

                    <!-- è¯­è¨€ -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="æ­Œè¯è¯­è¨€ *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <ComboBox ItemsSource="{Binding Languages}" 
                                  SelectedItem="{Binding Language}"
                                  FontSize="16" Padding="15" Height="50" />
                    </StackPanel>

                    <!-- å—ä¼—ä¿¡æ¯ -->
                    <Grid ColumnDefinitions="*,*">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Spacing="10">
                            <TextBlock Text="å—ä¼—å¹´é¾„æ®µ *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                            <ComboBox ItemsSource="{Binding AudienceAges}" 
                                      SelectedItem="{Binding AudienceAge}"
                                      FontSize="16" Padding="15" Height="50" />
                        </StackPanel>
                        <StackPanel Grid.Column="1" Spacing="10" Margin="20,0,0,0">
                            <TextBlock Text="å—ä¼—æ€§åˆ« *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                            <ComboBox ItemsSource="{Binding AudienceGenders}" 
                                      SelectedItem="{Binding AudienceGender}"
                                      FontSize="16" Padding="15" Height="50" />
                        </StackPanel>
                    </Grid>

                    <!-- ç›®æ ‡å¹³å° -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="ç›®æ ‡å¹³å° *" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <TextBlock Text="è‡³å°‘é€‰æ‹©ä¸€ä¸ªå¹³å°" FontSize="14" Foreground="#6B7280" />
                        <ItemsControl ItemsSource="{Binding Platforms}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <CheckBox Content="{Binding}" 
                                              Margin="0,0,15,10"
                                              Tag="{Binding}"
                                              Click="OnPlatformCheckBoxClick" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- éŸ³è°ƒï¼ˆå¯é€‰ï¼‰ -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="éŸ³è°ƒæè¿°ï¼ˆå¯é€‰ï¼‰" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <TextBox Text="{Binding Tone}"
                                 Watermark="ä¾‹å¦‚: æ¸©æš–æ²»æ„ˆã€é»‘æš—åŽ‹æŠ‘"
                                 FontSize="16" Padding="15" Height="50" />
                    </StackPanel>
                </StackPanel>

                <!-- Step 3: åˆ›ä½œæ¨¡å¼ -->
                <StackPanel MaxWidth="600" Margin="40" Spacing="30"
                           IsVisible="{Binding CurrentStep, Converter={StaticResource EqualToConverter}, ConverterParameter=3}">
                    <TextBlock Text="ðŸŽ¨ åˆ›ä½œæ¨¡å¼" FontSize="32" FontWeight="Bold" Foreground="#1F2937" />
                    
                    <!-- åˆ›ä½œæ¨¡å¼é€‰æ‹© -->
                    <StackPanel Spacing="20">
                        <RadioButton Content="æ•™ç»ƒæ¨¡å¼ - AI å¼•å¯¼é€æ­¥åˆ›ä½œï¼Œé€‚åˆæ·±åº¦æ‰“ç£¨"
                                    IsChecked="{Binding CreationMode, Converter={StaticResource EqualToConverter}, ConverterParameter=coach, Mode=OneWay}"
                                    Tag="coach"
                                    Click="OnCreationModeRadioButtonClick"
                                    FontSize="16"
                                    Padding="15"
                                    Margin="0,0,0,10" />
                        <RadioButton Content="å¿«é€Ÿæ¨¡å¼ - AI ä¸€é”®ç”Ÿæˆå®Œæ•´æ­Œè¯ï¼Œé€‚åˆå¿«é€Ÿåˆ›ä½œ"
                                    IsChecked="{Binding CreationMode, Converter={StaticResource EqualToConverter}, ConverterParameter=express, Mode=OneWay}"
                                    Tag="express"
                                    Click="OnCreationModeRadioButtonClick"
                                    FontSize="16"
                                    Padding="15"
                                    Margin="0,0,0,10" />
                        <RadioButton Content="æ··åˆæ¨¡å¼ - ç»“åˆå¼•å¯¼å’Œè‡ªåŠ¨ç”Ÿæˆï¼Œçµæ´»åˆ›ä½œ"
                                    IsChecked="{Binding CreationMode, Converter={StaticResource EqualToConverter}, ConverterParameter=hybrid, Mode=OneWay}"
                                    Tag="hybrid"
                                    Click="OnCreationModeRadioButtonClick"
                                    FontSize="16"
                                    Padding="15"
                                    Margin="0,0,0,10" />
                    </StackPanel>

                    <!-- MIDI æ–‡ä»¶é€‰æ‹©ï¼ˆä»…æ•™ç»ƒ/æ··åˆæ¨¡å¼ï¼‰ -->
                    <StackPanel Spacing="10" IsVisible="{Binding ShowMidiOption}">
                        <TextBlock Text="å‚è€ƒ MIDI æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰" FontSize="16" FontWeight="SemiBold" Foreground="#374151" />
                        <TextBlock Text="ä¸Šä¼  MIDI æ–‡ä»¶å¯ä»¥å¸®åŠ© AI æ›´å¥½åœ°ç†è§£æ—‹å¾‹å’ŒèŠ‚å¥" 
                                  FontSize="14" 
                                  Foreground="#6B7280" />
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox Grid.Column="0" Text="{Binding MidiFilePath}"
                                     Watermark="é€‰æ‹© MIDI æ–‡ä»¶..."
                                     FontSize="16" Padding="15" Height="50" IsReadOnly="True" />
                            <Button Grid.Column="1" Content="æµè§ˆ..." Command="{Binding SelectMidiFileCommand}"
                                    Classes="secondary" Margin="10,0,0,0" Width="100" Height="50" />
                        </Grid>
                    </StackPanel>
                </StackPanel>

                <!-- Step 4: ç¡®è®¤åˆ›å»º -->
                <StackPanel MaxWidth="600" Margin="40" Spacing="30"
                           IsVisible="{Binding CurrentStep, Converter={StaticResource EqualToConverter}, ConverterParameter=4}">
                    <TextBlock Text="âœ… ç¡®è®¤åˆ›å»º" FontSize="32" FontWeight="Bold" Foreground="#1F2937" />
                    
                    <Border Background="White" 
                            CornerRadius="12" 
                            Padding="30" 
                            BorderBrush="#E5E7EB" 
                            BorderThickness="1"
                            BoxShadow="0 2 8 0 #10000000">
                        <StackPanel Spacing="15">
                            <TextBlock Text="é¡¹ç›®ä¿¡æ¯æ‘˜è¦" FontSize="18" FontWeight="Bold" Foreground="#1F2937" Margin="0,0,0,10" />
                            <TextBlock Text="{Binding ProjectSummary}" 
                                      FontSize="14" 
                                      Foreground="#374151"
                                      TextWrapping="Wrap"
                                      LineHeight="24" />
                        </StackPanel>
                    </Border>
                    
                    <TextBlock Text="è¯·ç¡®è®¤ä»¥ä¸Šä¿¡æ¯æ— è¯¯åŽï¼Œç‚¹å‡»&quot;åˆ›å»ºé¡¹ç›®&quot;æŒ‰é’®å®Œæˆåˆ›å»ºã€‚" 
                              FontSize="14" 
                              Foreground="#6B7280"
                              TextWrapping="Wrap" />
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- åº•éƒ¨æŒ‰é’® -->
        <Border Grid.Row="2" Background="White" BorderBrush="#E5E7EB" BorderThickness="0,1,0,0" Padding="40,20">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                <!-- å–æ¶ˆæŒ‰é’® -->
                <Button Grid.Column="0" Content="å–æ¶ˆ" Command="{Binding CancelCommand}"
                        Classes="secondary" Width="120" Height="48" />

                <!-- ä¸Šä¸€æ­¥æŒ‰é’® -->
                <Button Grid.Column="2" Content="ä¸Šä¸€æ­¥" Command="{Binding PreviousStepCommand}"
                        Classes="secondary" Width="120" Height="48" Margin="0,0,15,0" />

                <!-- ä¸‹ä¸€æ­¥/åˆ›å»ºæŒ‰é’® -->
                <Grid Grid.Column="3">
                    <Button Command="{Binding NextStepCommand}"
                            IsVisible="{Binding CurrentStep, Converter={StaticResource LessThanConverter}, ConverterParameter=4}"
                            Classes="primary" Width="120" Height="48">
                        <TextBlock Text="ä¸‹ä¸€æ­¥" FontSize="16" FontWeight="SemiBold" />
                    </Button>

                    <Button Command="{Binding CreateProjectCommand}"
                            IsVisible="{Binding CurrentStep, Converter={StaticResource EqualToConverter}, ConverterParameter=4}"
                            Classes="primary" Width="140" Height="48">
                        <Button.Content>
                            <Grid>
                                <StackPanel Orientation="Horizontal" Spacing="8" 
                                           IsVisible="{Binding !IsCreating}"
                                           HorizontalAlignment="Center">
                                    <Path Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                                          Fill="White" Width="20" Height="20" Stretch="Uniform" />
                                    <TextBlock Text="åˆ›å»ºé¡¹ç›®" FontSize="16" FontWeight="SemiBold" />
                                </StackPanel>
                                <TextBlock Text="åˆ›å»ºä¸­..." 
                                          IsVisible="{Binding IsCreating}" 
                                          FontSize="16" 
                                          FontWeight="SemiBold"
                                          HorizontalAlignment="Center" />
                            </Grid>
                        </Button.Content>
                    </Button>
                </Grid>
            </Grid>
        </Border>

        <!-- é”™è¯¯æç¤º Toast -->
        <Border Grid.Row="0" Grid.RowSpan="3"
                IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                Background="#80000000" VerticalAlignment="Center" HorizontalAlignment="Center">
            <Border Background="White" CornerRadius="12" Padding="30" MaxWidth="500" BoxShadow="0 8 32 0 #20000000">
                <StackPanel Spacing="20">
                    <Path Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                          Fill="#DC2626" Width="48" Height="48" Stretch="Uniform" HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding ErrorMessage}" FontSize="16" Foreground="#1F2937" TextWrapping="Wrap" TextAlignment="Center" />
                    <Button Content="ç¡®å®š" Command="{Binding ClearErrorCommand}" Classes="primary" HorizontalAlignment="Center" Width="120" Height="44" />
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</UserControl>
